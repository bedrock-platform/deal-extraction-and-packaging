# Ticket DEAL-305: North Star Naming Taxonomy

**Ticket ID:** DEAL-305  
**Title:** Implement Industry-Standard "North Star" Package Naming Taxonomy  
**Status:** TODO  
**Priority:** HIGH  
**Phase:** Phase 3 (Stage 2 & 3 Integration)  
**Created:** January 2025  
**Assigned To:** Development Team

---

## Description

Implement industry-standard "North Star" package naming taxonomy based on naming conventions used by major programmatic curators (Magnite, The Trade Desk, PubMatic). This transforms generic cluster names into buyer-friendly, DSP-searchable package names that follow established industry patterns.

Currently, package names are generated by LLM without strict adherence to industry standards. This ticket adds:
1. Reference taxonomy templates for standardized naming
2. Quality prefix mapping rules (Premium, Performance, Essential, Verified)
3. Vertical bucket mapping (IAB → North Star taxonomy)
4. Format detection and keyword override logic
5. Post-processing to enforce naming convention format

## Business Value

- **DSP Compatibility:** Package names match what buyers search for in DSPs
- **Industry Alignment:** Follows naming conventions from major SSPs
- **Buyer Familiarity:** Uses pre-trained search patterns buyers already know
- **Value Signaling:** Names clearly communicate quality tier and use case
- **Searchability:** Standardized format improves discoverability

## Acceptance Criteria

- [ ] `naming_templates.json` reference file created with approved templates
- [ ] Quality prefix mapping rules implemented (Premium, Performance, Essential)
- [ ] Vertical bucket mapping (IAB → North Star) implemented
- [ ] Format detection with keyword override (CTV detection from publisher names)
- [ ] Stage 2 prompt updated to include naming convention guidance
- [ ] Post-processing function enforces naming format: `[Quality] [Vertical/Audience] [Format] Package`
- [ ] Package names follow industry-standard templates
- [ ] Seasonal event detection (optional, can use Gemini Search)

## Implementation Details

### Technical Approach

1. **Create Reference Taxonomy File:**
   - Create `config/package_creation/naming_templates.json`
   - Include quality prefix rules, approved templates, vertical mapping, format keywords
   - Include seasonal event definitions

2. **Update Stage 2 Prompt:**
   - Add naming convention section to `config/package_creation/package_grouping_prompt.txt`
   - Include reference to `naming_templates.json`
   - Guide LLM to use approved templates and quality prefixes

3. **Implement Quality Prefix Mapping:**
   - Create `src/package_creation/naming.py`:
     - `determine_quality_prefix()` function
     - Maps `quality_tier` + conditions → "Premium", "Performance", "Essential"
     - Handles major broadcaster/CTV detection
     - Handles high-scale/e-commerce detection

4. **Implement Format Detection:**
   - Create `detect_format()` function
   - Uses `deal.format` field as primary source
   - Overrides based on publisher keywords (Pluto, Tubi, Sling → CTV)
   - Returns standardized format string

5. **Implement Post-Processing:**
   - Create `enforce_naming_convention()` function
   - Validates package names match `[Quality] [Vertical/Audience] [Format] Package` format
   - Uses regex to enforce format
   - Falls back to template-based naming if LLM output doesn't match

6. **Update PackageCreator:**
   - Integrate naming functions into `create_packages()` method
   - Apply post-processing to LLM-generated names
   - Ensure all package names follow convention

### Code Changes

- **NEW:** `config/package_creation/naming_templates.json`
  - Reference taxonomy with approved templates
  - Quality prefix rules
  - Vertical mapping
  - Format keywords
  - Seasonal events

- **NEW:** `src/package_creation/naming.py`
  - `determine_quality_prefix()` function
  - `detect_format()` function
  - `enforce_naming_convention()` function
  - `map_vertical_to_north_star()` function

- **MODIFY:** `config/package_creation/package_grouping_prompt.txt`
  - Add naming convention section
  - Include reference to templates
  - Guide LLM to use approved formats

- **MODIFY:** `src/package_creation/creator.py`
  - Integrate naming functions
  - Apply post-processing to package names

### Quality Prefix Mapping Rules

```python
def determine_quality_prefix(deal: Dict[str, Any]) -> str:
    """
    Map quality_tier to industry-standard prefix.
    
    Rules:
    - "Premium": quality_tier == "Premium" AND (major_broadcaster OR ctv_publisher)
    - "Performance": (quality_tier == "RON" OR "Mid-tier") AND (high_scale OR ecommerce)
    - "Essential": quality_tier == "Mid-tier" AND (news OR entertainment)
    """
    quality_tier = deal.get('commercial', {}).get('quality_tier')
    volume_tier = deal.get('commercial', {}).get('volume_tier')
    format_type = deal.get('format', '').lower()
    publishers = deal.get('publishers', [])
    
    # Check for major broadcasters/CTV
    ctv_keywords = ['pluto', 'tubi', 'sling', 'roku', 'disney', 'paramount', 'nbc', 'cbs']
    is_ctv = format_type == 'video' and any(kw in ' '.join(publishers).lower() for kw in ctv_keywords)
    
    if quality_tier == 'Premium' and is_ctv:
        return 'Premium'
    
    if quality_tier in ('RON', 'Mid-tier') and volume_tier == 'High':
        return 'Performance'
    
    if quality_tier == 'Mid-tier':
        return 'Essential'
    
    # Default fallback
    return 'Essential'
```

### Format Detection Rules

```python
def detect_format(deal: Dict[str, Any]) -> str:
    """
    Detect format with keyword override.
    
    Priority:
    1. deal.format field
    2. Publisher keywords (Pluto, Tubi, Sling → CTV)
    3. Inventory type hints
    """
    format_type = deal.get('format', '').lower()
    publishers = ' '.join(deal.get('publishers', [])).lower()
    
    # CTV keyword override
    ctv_keywords = ['pluto', 'tubi', 'sling', 'roku', 'fire tv', 'apple tv']
    if any(kw in publishers for kw in ctv_keywords):
        return 'CTV'
    
    # Use deal.format as-is
    if format_type:
        return format_type.capitalize()
    
    return 'Display'  # Default
```

### Dependencies

- [ ] Phase 1 Complete (DEAL-101, DEAL-102, DEAL-103) - **BLOCKER** ✅
- [ ] Phase 2 Complete (DEAL-202, DEAL-203, DEAL-204) - **BLOCKER** ✅
- [ ] DEAL-302 (Stage 1 → Stage 2 Integration) - **BLOCKER** ✅
- [ ] Stage 1.5 (ads.txt verification) - **OPTIONAL** (for "Verified" prefix, deferred)

## Testing

- [ ] Unit tests: Quality prefix mapping rules work correctly
- [ ] Unit tests: Format detection with keyword override
- [ ] Unit tests: Naming convention enforcement (regex validation)
- [ ] Unit tests: Vertical mapping (IAB → North Star)
- [ ] Integration tests: Package names follow convention after post-processing
- [ ] Manual tests: Verify package names match industry standards
- [ ] Manual tests: Verify names are DSP-searchable

## Related Tickets

- Blocked by: DEAL-302 (Stage 1 → Stage 2 Integration)
- Related to: DEAL-304 (Incremental Processing - may need to preserve naming)
- Future: Stage 1.5 (ads.txt verification for "Verified" prefix)

## Reference Materials

- **Consultant Guidance:** Industry-standard naming taxonomy from Magnite, The Trade Desk, PubMatic
- **Naming Templates:** `config/package_creation/naming_templates.json`
- **Stage 2 Prompt:** `config/package_creation/package_grouping_prompt.txt`

## Notes

- "Verified" prefix requires ads.txt verification (Stage 1.5) - defer for now
- Seasonal event detection can use Gemini Search (optional enhancement)
- Post-processing ensures format compliance even if LLM doesn't follow convention
- Format detection prioritizes publisher keywords over deal.format for CTV accuracy

---

**Template Source:** `../templates/ticket_template.md`
